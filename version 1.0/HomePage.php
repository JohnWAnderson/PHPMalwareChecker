<?php
require_once 'Functions.php';
require_once 'Data.php';
#set global variables to nothing to prevent script information
$location = "";
$link = null;
$type = '';
$size = 8388608;
$string = '';
$sql = '';
$result = null;
$row = '';
$name = '';
$Sequence = '';
$counter = 0;
	
    echo <<<_END
	    <html>
		<head><title>Home Page</title></head>
		<head>Home Page</head>
		<Br>
		<body>
        <input type="button" value="Admin Page" onclick="location='LoginAdmin.php'" />
        <form action="HomePage.php" method="post" enctype="multipart/form-data">
        <input type="file" name="file" id= "file" required/>
        <input type="submit" value="Submit File" /> 
        </form>
_END;

    if($_FILES)
    {
		$location = $_FILES['file']['tmp_name'];
		$type = $_FILES['file']['type'];
		echo 'MalWare: <Br>';
		$link = mysqli_connect($hn, $un, $pw, $db);
		if (mysqli_connect_errno()) die(mysqli_connect_error());
		if(($size = filesize($location)) >= 8388608 ){
			echo "File To Big";
		}
		else{
			$String = getBytes($link, $location, $type, $size);
			#echo " $String <Br>";
			$result = getAllMalware($link);
			mysqli_close($link); # close because done
			if($result === False){
				echo "No MalWare Detected";
			}	
			else{
				foreach($result as $row ){	
					$Name = $row['Name'];
					$Sequence = $row['Sequence'];
					if(is_string($Sequence) && strlen($Sequence) > 0){
						if(strpos($String, $Sequence) !== false){
							echo "$Name:";
							echo "<Br>";
							$counter += 1;
						}
					}
				}
				mysqli_free_result($result);
				if($counter === 0)
					echo'no MalWare Detected';
			}
		}
	}
	
	if(isset($_POST['PageSubmit'])){
		header("Location: http://www.example.com/page.php");
		exit;
	}
	
	
    echo "</body></html>";
	

	#takes a file and returns an array of only the numeric numbers in file

	
?>