<?php
require_once 'Functions.php';
require_once 'secure.php';
require_once 'Data.php';
session_start();
$username = '';
$password = '';
$link = null;
    echo <<<_END
	    <html>
		<head><title>Login Page</title></head>
		<head>Login Page</head>
		<Br>
		<body>
        <input type="button" value="HomePage" onclick="location='HomePage.php'" />
		<form action="LoginAdmin.php" method="post" enctype="multipart/form-data">
		<label for='username' >UserName:</label>
		<input type = "text" maxlength="32" name = "username" id = "username" required/>
		<Br>
		<label for='password' >Password:</label>
		<input type = "password" maxlength="32" name = "password" id = "password" required/>
		<Br>
		<input type="submit" value="Submit" />
		</form>
_END;

	if(isset($_SESSION['check']) && isset($_COOKIE['token']) && $_SESSION['check'] === hash('ripemd128', $_SERVER['REMOTE_ADDR'] . $_SERVER['HTTP_USER_AGENT'] . $_COOKIE['token']))
	{
		header('Location: AdminPage.php');
	}
	

	if($_SERVER['REQUEST_METHOD'] === 'POST') {
		$link = mysqli_connect($hn, $un, $pw, $db);
		if (mysqli_connect_errno()) die(mysqli_connect_error());
		$username = mysql_entities_fix_string($link ,($_POST['username']));
		$password = mysql_entities_fix_string($link ,($_POST['password']));
		if(login($link, $username, $password)){
			#setCookies($username, $password); don't need anymore from sessions
			startSession($username);
			header('Location: AdminPage.php');
		}
		mysqli_close($link);
	}
	

	
	echo "</body></html>";
	
		

?>