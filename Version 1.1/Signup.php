<?php
require_once 'Functions.php';
require_once 'Data.php';
require_once 'secure.php';
echo <<<_END
	    <html>
		<head>
			<title> form </title>	
			<script>
			function Validate(form) {
				fail = validateUsername(form.username.value)
				fail += validatePassword(form.password.value)
				fail += validateEmail(form.email.value)
				if (fail == "") return true
				else { alert(fail); return false }
			}
				
			function validateUsername(field){
				var regex = /^[0-9a-zA-Z_-]+$/;
				if(field== "") return "no UserName entered.\n"
				else if(field.length < 5) return "UserName Length must be at least 5.\n"
				else if(!field.match(regex)) return "Invalid characters used in username .\n"
				else return ""
			}
			
			function validatePassword(field){
				var regex = /^[0-9a-zA-Z!@#$%^&*()_+-=]+$/;
				if(field== "") return "no Password entered.\n"
				else if(field.length < 6) return "Password Length must be at least 6.\n"
				else if(!field.match(regex)) return "Invalid characters used in password.\n"
				else return ""
			}
			
			function validateEmail(field){
				var regex = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
				if(field== "") return "no Email entered.\n"
				else if(!field.match(regex)) return "Invalid Email used.\n"
				else return ""
			}
					
			</script>
		</head>
		<body>
		<input type="button" value="HomePage" onclick="location='HomePage.php'" />
		<input type="button" value="Login Page" onclick="location='LoginAdmin.php'" />
		<form name = "htmlform" action="Signup.php" method="post" onsubmit = "return Validate(this)" enctype="multipart/form-data">
		<label for='email' >Email:</label>
		<input type = "email" maxlength="64" name = "email" id = "email" required/>
		<Br>
		<label for='username' >UserName:</label>
		<input type = "text" maxlength="32" name = "username" id = "username" required/>
		<Br>
		<label for='password' >Password:</label>
		<input type = "password" maxlength="32" name = "password" id = "password" required/>
		<Br>
		<input type="submit" value="submit" name = "submit" />
		</form>
_END;

$Email = '';
$username = '';
$password = '';
	
	if(isset($_POST['submit']))
	{
		$email = checkEmail($_POST['email']);
		$username = CheckUser($_POST['username']);
		$password = CheckPass($_POST['password']);
		$link = mysqli_connect($hn, $un, $pw, $db);
		if (mysqli_connect_errno()) die(mysqli_connect_error());
		UserCheckDup($link, $username);
		AddNewUser($link, $username, $email, $password);	
		echo "$username your account was created";
	}


echo"</body></html>";

?>