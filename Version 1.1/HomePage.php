<?php
require_once 'Functions.php';
require_once 'Data.php';
#set global variables to nothing to prevent script information
$location = "";
$link = null;
$type = '';
$size = 8388608;
$String = '';
$sql = '';
$result = null;
$row = '';
$rows = [];
$name = '';
$Sequence = '';
$counter = 0;
$i = 0;
$Bytes = '';
$subString = '';
	
    echo <<<_END
	    <html>
		<head><title>Home Page</title></head>
		<head>Home Page</head>
		<Br>
		<body>
        <input type="button" value="Login Page" onclick="location='LoginAdmin.php'" />
        <form action="HomePage.php" method="post" enctype="multipart/form-data">
        <input type="file" name="file" id= "file" required/>
        <input type="submit" value="Submit File" /> 
        </form>
_END;
    if($_FILES)
    {
		$location = $_FILES['file']['tmp_name'];
		$type = $_FILES['file']['type'];
		echo 'MalWare: <Br>';
		$link = mysqli_connect($hn, $un, $pw, $db);
		if (mysqli_connect_errno()) die(mysqli_connect_error());
		if(($size = filesize($location)) >= 8388608 ){
			echo "File To Big";
		}
		else{
			$String = getBytes($location, $type, $size);
			$result = getAllMalware($link);
			foreach($result as $row){
				$rows[] = $row;
			}
			$result->close();
			mysqli_close($link); # close because done
			if(empty($rows)){
				echo "No MalWare Detected bruh";
			}	
			else{
				while($i <= $size){
					$subString = substr ($String, $i, 20);
					$Bytes = hashBytes($subString);
					foreach($rows as $row ){	
						$Sequence = $row['Sequence'];
						if($Bytes === $Sequence){
							$Name = $row['Name'];
							echo "$Name: $Sequence";
							echo "<Br>";
							$counter += 1;
						}
					}
					$i += 1;
				}
				if($counter === 0)
					echo'no MalWare Detected';
			}
		}
	}
	
	if(isset($_POST['PageSubmit'])){
		header("Location: http://www.example.com/page.php");
		exit;
	}
	
	
    echo "</body></html>";
	

	#takes a file and returns an array of only the numeric numbers in file

	
?>